<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Data rectangling in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Muhammad Aswan Syahputra" />
    <meta name="date" content="2019-09-01" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="assets/aswansyahputra.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">








class: inverse, left, middle
background-image: url("assets/r-indonesia.svg")
background-size: 500px
background-position: 12.5% 50%

.pull-right[
# Data rectangling:
### *a journey from `JSON` to `CSV`*
***
#### Muhammad Aswan Syahputra
]

---
class: middle
background-image: url("assets/aswan.jpg")
background-size: 450px
background-position: 87.5% 50%

.pull-left[
## About me
+ Sensory scientist @ [Sensolution.ID](https://sensolution.id)
+ Instructor @ [R Academy Telkom University](https://dbe.telkomuniversity.ac.id/r-academy/)
+ Initiator of [Komunitas R Indonesia](https://t.me/GNURIndonesia) (est. 13 August 2016)
+ <i class="fas  fa-cube "></i> : `sensehubr`, `nusandata`,
`bandungjuara`, `prakiraan`, etc
+ <i class="fas  fa-desktop "></i> : `sensehub`, `thermostats`,
`aquastats`, `bcrp`, `bandungjuara`, etc
+ <i class="fab  fa-telegram "></i> : aswansyahputra
+ <i class="fab  fa-twitter "></i> : aswansyahputra_
+ <i class="fab  fa-github "></i> : aswansyahputra
+ <i class="fab  fa-linkedin "></i> : aswansyahputra
]

---
class: inverse, middle

# Know your neighbours! ü§ù

+ *Who are you?*
+ *What do you do with data?*
+ *How do you describe your experience with R?*

--

<div class="countdown" id="timer_5d6b5a2f" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

### Let's play with some basics! üê£

--

.pull-left[

```r
(x1 &lt;- "useR! Yogyakarta")
#&gt; [1] "useR! Yogyakarta"
(x2 &lt;- TRUE)
#&gt; [1] TRUE
(x3 &lt;- 1.43)
#&gt; [1] 1.43
(x4 &lt;- 1L:5L)
#&gt; [1] 1 2 3 4 5
```
Can you guess the **type** of `x1`, `x2`, `x3`, and `x4`? How about their **length**?
]

--

.pull-right[

```r
typeof(x1)
#&gt; [1] "character"
length(x1)
#&gt; [1] 1
typeof(x2)
#&gt; [1] "logical"
length(x2)
#&gt; [1] 1
typeof(x3)
#&gt; [1] "double"
length(x3)
#&gt; [1] 1
```
What about `x4`? ü§î
]

---
class: inverse, middle

# How to combine `x1`, `x2`, `x3`, and `x4` without losing their properties?

---

### The use of `c()`

.pull-left[

```r
(xs_c &lt;- c(x1, x2, x3, x4))
#&gt; [1] "useR! Yogyakarta" "TRUE"             "1.43"            
#&gt; [4] "1"                "2"                "3"               
#&gt; [7] "4"                "5"
```
It seems off, doesn't it? üò≠ Can you explain? üòï
]

--

.pull-right[
Let's check it! üîç

```r
length(xs_c)
#&gt; [1] 8
typeof(xs_c)
#&gt; [1] "character"
```
`length` ‚ùå, `type` ‚ùìWhat's happening? üëª
]

---

### The use of `list()`

.pull-left[

```r
(xs_list &lt;- list(x1, x2, x3, x4))
#&gt; [[1]]
#&gt; [1] "useR! Yogyakarta"
#&gt; 
#&gt; [[2]]
#&gt; [1] TRUE
#&gt; 
#&gt; [[3]]
#&gt; [1] 1.43
#&gt; 
#&gt; [[4]]
#&gt; [1] 1 2 3 4 5
```
Hmm, not so familiar but it seems to be what we wanted, right? üòâ
]

--

.pull-right[
Let's also check it! üîç

```r
length(xs_list)
#&gt; [1] 4
typeof(xs_list)
#&gt; [1] "list"
```
`length` ‚úÖ, `type` ‚ùì What is `list`? üí≠
]

---
class: inverse, middle

# Hold on! üõë

--

## How to check if the `type` and `length` of each element are preserved?

---

### The good old `for` loop üíñ


```r
types_xs_c &lt;- vector("character", length = length(xs_c))
for (i in seq_along(xs_c)) {
  types_xs_c[[i]] &lt;- typeof(xs_c[[i]])
}
types_xs_c
#&gt; [1] "character" "character" "character" "character" "character" "character"
#&gt; [7] "character" "character"
```

--


```r
lengths_xs_c &lt;- vector("integer", length = length(xs_c))
for (i in seq_along(xs_c)) {
  lengths_xs_c[[i]] &lt;- length(xs_c[[i]])
}
lengths_xs_c
#&gt; [1] 1 1 1 1 1 1 1 1
```

--

How would you perform the same procedure for `xs_list`? üò© Save your results as `types_xs_list` and `lengths_xs_list`!

---

### Let me introduce you to `functional` üòé


```r
vapply(xs_c, typeof, character(1), USE.NAMES = FALSE)
#&gt; [1] "character" "character" "character" "character" "character" "character"
#&gt; [7] "character" "character"
vapply(xs_c, length, integer(1), USE.NAMES = FALSE)
#&gt; [1] 1 1 1 1 1 1 1 1
```

--


```r
vapply(xs_list, typeof, character(1), USE.NAMES = FALSE)
#&gt; [1] "character" "logical"   "double"    "integer"
vapply(xs_list, length, integer(1), USE.NAMES = FALSE)
#&gt; [1] 1 1 1 5
```

--

Ok, it surely looks simpler but still... üôÑ

--


```r
library(purrr)
map_chr(xs_list, typeof)
#&gt; [1] "character" "logical"   "double"    "integer"
map_int(xs_list, length)
#&gt; [1] 1 1 1 5
```

--

So much simpler and better, isn't it? üéâ

---
class: inverse, middle

# `list` resembles `JSON` very much!

--

## Have a look at following comparison using subset of `billionaires` data ü§ë

---

.pull-left[
**Raw JSON file**
.scrollable-slide[

```bash
cd data-raw
cat billionaires_small.json
#&gt; [
#&gt;   {
#&gt;     "wealth": {
#&gt;       "worth in billions": [3.6],
#&gt;       "how": {
#&gt;         "category": ["Traded Sectors"],
#&gt;         "from emerging": [true],
#&gt;         "industry": ["Consumer"],
#&gt;         "was political": [false],
#&gt;         "inherited": [true],
#&gt;         "was founder": [true]
#&gt;       },
#&gt;       "type": ["founder non-finance"]
#&gt;     },
#&gt;     "company": {
#&gt;       "sector": ["agricultural products"],
#&gt;       "founded": [1929],
#&gt;       "type": ["new"],
#&gt;       "name": ["J.R. Simplot Company"],
#&gt;       "relationship": ["founder"]
#&gt;     },
#&gt;     "rank": [115],
#&gt;     "location": {
#&gt;       "gdp": [10600000000000],
#&gt;       "region": ["North America"],
#&gt;       "citizenship": ["United States"],
#&gt;       "country code": ["USA"]
#&gt;     },
#&gt;     "year": [2001],
#&gt;     "demographics": {
#&gt;       "gender": ["male"],
#&gt;       "age": [92]
#&gt;     },
#&gt;     "name": ["John Simplot"]
#&gt;   },
#&gt;   {
#&gt;     "wealth": {
#&gt;       "worth in billions": [2.5],
#&gt;       "how": {
#&gt;         "category": ["Financial"],
#&gt;         "from emerging": [true],
#&gt;         "industry": ["Money Management"],
#&gt;         "was political": [false],
#&gt;         "inherited": [true],
#&gt;         "was founder": [true]
#&gt;       },
#&gt;       "type": ["inherited"]
#&gt;     },
#&gt;     "company": {
#&gt;       "sector": ["banking"],
#&gt;       "founded": [1945],
#&gt;       "type": ["new"],
#&gt;       "name": ["Kasikornbank"],
#&gt;       "relationship": ["relation"]
#&gt;     },
#&gt;     "rank": [143],
#&gt;     "location": {
#&gt;       "gdp": [182000000000],
#&gt;       "region": ["East Asia"],
#&gt;       "citizenship": ["Thailand"],
#&gt;       "country code": ["THA"]
#&gt;     },
#&gt;     "year": [1996],
#&gt;     "demographics": {
#&gt;       "gender": ["male"],
#&gt;       "age": [-1]
#&gt;     },
#&gt;     "name": ["Banyong Lamsam"]
#&gt;   },
#&gt;   {
#&gt;     "wealth": {
#&gt;       "worth in billions": [1.8],
#&gt;       "how": {
#&gt;         "category": ["Non-Traded Sectors"],
#&gt;         "from emerging": [true],
#&gt;         "industry": ["Retail, Restaurant"],
#&gt;         "was political": [false],
#&gt;         "inherited": [true],
#&gt;         "was founder": [true]
#&gt;       },
#&gt;       "type": ["founder non-finance"]
#&gt;     },
#&gt;     "company": {
#&gt;       "sector": ["uniforms"],
#&gt;       "founded": [1968],
#&gt;       "type": ["new"],
#&gt;       "name": ["Cintas Corporation"],
#&gt;       "relationship": ["founder"]
#&gt;     },
#&gt;     "rank": [272],
#&gt;     "location": {
#&gt;       "gdp": [10600000000000],
#&gt;       "region": ["North America"],
#&gt;       "citizenship": ["United States"],
#&gt;       "country code": ["USA"]
#&gt;     },
#&gt;     "year": [2001],
#&gt;     "demographics": {
#&gt;       "gender": ["male"],
#&gt;       "age": [66]
#&gt;     },
#&gt;     "name": ["Richard Farmer"]
#&gt;   }
#&gt; ]
```
]
]

--

.pull-right[
**When imported to R**
.scrollable-slide[

```r
str(billionaires_small, max.level = 3)
#&gt; List of 3
#&gt;  $ :List of 7
#&gt;   ..$ wealth      :List of 3
#&gt;   .. ..$ worth in billions: num 3.6
#&gt;   .. ..$ how              :List of 6
#&gt;   .. ..$ type             : chr "founder non-finance"
#&gt;   ..$ company     :List of 5
#&gt;   .. ..$ sector      : chr "agricultural products"
#&gt;   .. ..$ founded     : int 1929
#&gt;   .. ..$ type        : chr "new"
#&gt;   .. ..$ name        : chr "J.R. Simplot Company"
#&gt;   .. ..$ relationship: chr "founder"
#&gt;   ..$ rank        : int 115
#&gt;   ..$ location    :List of 4
#&gt;   .. ..$ gdp         : num 1.06e+13
#&gt;   .. ..$ region      : chr "North America"
#&gt;   .. ..$ citizenship : chr "United States"
#&gt;   .. ..$ country code: chr "USA"
#&gt;   ..$ year        : int 2001
#&gt;   ..$ demographics:List of 2
#&gt;   .. ..$ gender: chr "male"
#&gt;   .. ..$ age   : int 92
#&gt;   ..$ name        : chr "John Simplot"
#&gt;  $ :List of 7
#&gt;   ..$ wealth      :List of 3
#&gt;   .. ..$ worth in billions: num 2.5
#&gt;   .. ..$ how              :List of 6
#&gt;   .. ..$ type             : chr "inherited"
#&gt;   ..$ company     :List of 5
#&gt;   .. ..$ sector      : chr "banking"
#&gt;   .. ..$ founded     : int 1945
#&gt;   .. ..$ type        : chr "new"
#&gt;   .. ..$ name        : chr "Kasikornbank"
#&gt;   .. ..$ relationship: chr "relation"
#&gt;   ..$ rank        : int 143
#&gt;   ..$ location    :List of 4
#&gt;   .. ..$ gdp         : num 1.82e+11
#&gt;   .. ..$ region      : chr "East Asia"
#&gt;   .. ..$ citizenship : chr "Thailand"
#&gt;   .. ..$ country code: chr "THA"
#&gt;   ..$ year        : int 1996
#&gt;   ..$ demographics:List of 2
#&gt;   .. ..$ gender: chr "male"
#&gt;   .. ..$ age   : int -1
#&gt;   ..$ name        : chr "Banyong Lamsam"
#&gt;  $ :List of 7
#&gt;   ..$ wealth      :List of 3
#&gt;   .. ..$ worth in billions: num 1.8
#&gt;   .. ..$ how              :List of 6
#&gt;   .. ..$ type             : chr "founder non-finance"
#&gt;   ..$ company     :List of 5
#&gt;   .. ..$ sector      : chr "uniforms"
#&gt;   .. ..$ founded     : int 1968
#&gt;   .. ..$ type        : chr "new"
#&gt;   .. ..$ name        : chr "Cintas Corporation"
#&gt;   .. ..$ relationship: chr "founder"
#&gt;   ..$ rank        : int 272
#&gt;   ..$ location    :List of 4
#&gt;   .. ..$ gdp         : num 1.06e+13
#&gt;   .. ..$ region      : chr "North America"
#&gt;   .. ..$ citizenship : chr "United States"
#&gt;   .. ..$ country code: chr "USA"
#&gt;   ..$ year        : int 2001
#&gt;   ..$ demographics:List of 2
#&gt;   .. ..$ gender: chr "male"
#&gt;   .. ..$ age   : int 66
#&gt;   ..$ name        : chr "Richard Farmer"
```
]
]

---
class: inverse, middle

# How to extract the element(s) of a `list`?

---

### From a billionaire, extract info üíµ

.pull-left[
.scrollable-slide[

```r
library(purrr)
pluck(billionaires_small, 1) # you can also use billionaires_small[[1]]
#&gt; $wealth
#&gt; $wealth$`worth in billions`
#&gt; [1] 3.6
#&gt; 
#&gt; $wealth$how
#&gt; $wealth$how$category
#&gt; [1] "Traded Sectors"
#&gt; 
#&gt; $wealth$how$`from emerging`
#&gt; [1] TRUE
#&gt; 
#&gt; $wealth$how$industry
#&gt; [1] "Consumer"
#&gt; 
#&gt; $wealth$how$`was political`
#&gt; [1] FALSE
#&gt; 
#&gt; $wealth$how$inherited
#&gt; [1] TRUE
#&gt; 
#&gt; $wealth$how$`was founder`
#&gt; [1] TRUE
#&gt; 
#&gt; 
#&gt; $wealth$type
#&gt; [1] "founder non-finance"
#&gt; 
#&gt; 
#&gt; $company
#&gt; $company$sector
#&gt; [1] "agricultural products"
#&gt; 
#&gt; $company$founded
#&gt; [1] 1929
#&gt; 
#&gt; $company$type
#&gt; [1] "new"
#&gt; 
#&gt; $company$name
#&gt; [1] "J.R. Simplot Company"
#&gt; 
#&gt; $company$relationship
#&gt; [1] "founder"
#&gt; 
#&gt; 
#&gt; $rank
#&gt; [1] 115
#&gt; 
#&gt; $location
#&gt; $location$gdp
#&gt; [1] 1.06e+13
#&gt; 
#&gt; $location$region
#&gt; [1] "North America"
#&gt; 
#&gt; $location$citizenship
#&gt; [1] "United States"
#&gt; 
#&gt; $location$`country code`
#&gt; [1] "USA"
#&gt; 
#&gt; 
#&gt; $year
#&gt; [1] 2001
#&gt; 
#&gt; $demographics
#&gt; $demographics$gender
#&gt; [1] "male"
#&gt; 
#&gt; $demographics$age
#&gt; [1] 92
#&gt; 
#&gt; 
#&gt; $name
#&gt; [1] "John Simplot"
```
]
]

--

.pull-right[

```r
pluck(billionaires_small, 1, "name") # you can also use billionaires_small[[1]][["name"]]
#&gt; [1] "John Simplot"

pluck(billionaires_small, 1, "rank")
#&gt; [1] 115

pluck(billionaires_small, 1, "wealth", "worth in billions")
#&gt; [1] 3.6
```
]

---

### From some billionaires, extract info üíµ

.pull-left[

```r
map(billionaires_small, pluck, "name")
#&gt; [[1]]
#&gt; [1] "John Simplot"
#&gt; 
#&gt; [[2]]
#&gt; [1] "Banyong Lamsam"
#&gt; 
#&gt; [[3]]
#&gt; [1] "Richard Farmer"

map(billionaires_small, pluck, "wealth", "worth in billions")
#&gt; [[1]]
#&gt; [1] 3.6
#&gt; 
#&gt; [[2]]
#&gt; [1] 2.5
#&gt; 
#&gt; [[3]]
#&gt; [1] 1.8
```
]

--

.pull-right[

```r
(billionaire_names &lt;- map_chr(billionaires_small, "name"))
#&gt; [1] "John Simplot"   "Banyong Lamsam" "Richard Farmer"
(billionaire_ranks &lt;- map_int(billionaires_small, "rank"))
#&gt; [1] 115 143 272
(billionaire_worth &lt;- map_dbl(billionaires_small, list("wealth", "worth in billions")))
#&gt; [1] 3.6 2.5 1.8
```

## Awesome, `map()` provides a shortcut! Bye `pluck()`~ üëã

]

---

class: inverse, middle

# Yeay, we can extract some infos üí™

--

## But, now they are scattered üòí

---

### Of course you can combine them later using `data.frame()` or `tibble()`, but... üò´

--

.pull-left[

```r
data.frame(
  name = billionaire_names,
  rank = billionaire_ranks,
  worth_in_billions = billionaire_worth,
  stringsAsFactors = FALSE
)
#&gt;             name rank worth_in_billions
#&gt; 1   John Simplot  115               3.6
#&gt; 2 Banyong Lamsam  143               2.5
#&gt; 3 Richard Farmer  272               1.8
```
]

--

.pull-right[

```r
library(tibble)
tibble(
  name = billionaire_names,
  rank = billionaire_ranks,
  worth_in_billions = billionaire_worth
)
#&gt; # A tibble: 3 x 3
#&gt;   name            rank worth_in_billions
#&gt;   &lt;chr&gt;          &lt;int&gt;             &lt;dbl&gt;
#&gt; 1 John Simplot     115               3.6
#&gt; 2 Banyong Lamsam   143               2.5
#&gt; 3 Richard Farmer   272               1.8
```
]

---

### Why don't we contain the `list` in `dataframe`/`tibble` in the first place?

--

.pull-left[
Let's embrace `list-column` ü•Å

```r
library(tibble)
billionaires_small_df &lt;- 
  billionaires_small %&gt;% 
  enframe()
billionaires_small_df
#&gt; # A tibble: 3 x 2
#&gt;    name value           
#&gt;   &lt;int&gt; &lt;list&gt;          
#&gt; 1     1 &lt;named list [7]&gt;
#&gt; 2     2 &lt;named list [7]&gt;
#&gt; 3     3 &lt;named list [7]&gt;
```
]

--

.pull-right[
Now we can make use of `dplyr`, ain't it cool? ü§≠

```r
library(dplyr)
billionaires_small_df %&gt;% 
  mutate(
    name = map_chr(value, "name"),
    rank = map_int(value, "rank"),
    worth_in_billions = map_dbl(
      value, 
      list("wealth", "worth in billions"))
  ) %&gt;% 
  select(-value)
#&gt; # A tibble: 3 x 3
#&gt;   name            rank worth_in_billions
#&gt;   &lt;chr&gt;          &lt;int&gt;             &lt;dbl&gt;
#&gt; 1 John Simplot     115               3.6
#&gt; 2 Banyong Lamsam   143               2.5
#&gt; 3 Richard Farmer   272               1.8
```
]

---
class: inverse, middle

# Let's practice! ü§©

+ *Open your RStudio, then install `usethis` package*
+ *Once succeed, run `usethis::use_course("aswansyahputra/kpdr_jogja")`*
+ *Follow the instructions and new RStudio session will be automatically opened*
+ *Please open `hands-on.Rmd` and read the instructions thoroughly*

---
class: left, middle
background-image: url("assets/r-indonesia.svg")
background-size: 500px
background-position: 12.5% 50%

.pull-right[
# Thank you!
### <i class="fab  fa-telegram "></i> [t.me/GNURIndonesia](https://t.me/GNURIndonesia)
### <i class="fas  fa-globe "></i> [r-indonesia.id](https://r-indonesia.id)
### <i class="fas  fa-envelope "></i> [info@r-indonesia.id](mailto:info@r-indonesia.id)
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
